-- ============================================
-- CREATE TABLE: Kafka Source (CDC)
-- ============================================
CREATE TABLE ods_back_account (
    PK_ACCOUNT STRING,
    C_ACCOUNT_BRANCH_CODE STRING,
    C_ACCOUNT_SUB_BRANCH_CODE STRING,
    C_CREATOR_CODE STRING,
    C_CREATOR_BRANCH_CODE STRING,
    C_CREATOR_SUB_BRANCH_CODE STRING,
    C_CREATE_TIME STRING,
    C_APPROVER_CODE STRING,
    C_APPROVE_TIME STRING,
    C_CUSTOMER_CODE STRING,
    C_ACCOUNT_CODE STRING,
    C_ACCOUNT_TYPE STRING,
    C_ACCOUNT_FRONT_TYPE STRING,
    C_ACCOUNT_RELATION_TYPE STRING,
    C_STAFF_FLAG STRING,
    C_MARKETING_ID STRING,
    C_TAX_FLAG STRING,
    C_OPEN_DATE STRING,
    C_CLOSE_DATE STRING,
    C_BANK_CODE STRING,
    C_BANK_ACCOUNT STRING,
    C_COMM_PACKAGE STRING,
    C_ACCOUNT_STATUS STRING,
    C_CLOSER_CODE STRING,
    C_CLOSE_TIME STRING,
    C_NEW_CUST_EXPIRE_DATE STRING,
    C_COLLABORATOR STRING,
    C_MODIFY_USER_CODE STRING,
    C_RESTRICTION_ID STRING,
    C_CHANNEL STRING,
    C_GROUP_CODE STRING,
    C_ACCOUNT_CREDIT_TYPE DOUBLE,
    C_ORIGIN_ACCOUNT_CODE STRING,
    C_ACCOUNT_LEVEL STRING,
    C_CAN_SHORT_SELL STRING,
    C_CAN_OVER_CREDIT STRING,
    C_FORCE_SELL STRING,
    C_LENDING_SELL STRING,
    C_TRADING_STATUS DOUBLE,
    C_ONLINE_ACCOUNT_TYPE STRING,
    C_SUB_MARKETING_ID STRING,
    C_CHANGED_TAB STRING,
    C_TC_SIGNED_STATUS DOUBLE,
    C_ODD_LOT_CONTRACT_SIGNED DOUBLE,
    C_ODD_LOT_CONTRACT_NOTE STRING,
    C_DEPOSIT_APPROVER_CODE STRING,
    C_DEPOSIT_APPROVE_DATE STRING,
    C_COMM_BASE_RATE DOUBLE,
    C_ATS_FLAG DOUBLE,
    C_ATS_BANK_ACCOUNT STRING,
    C_ATS_BANK STRING,
    C_BANK_RESPONSE_MAPPING STRING,
    C_RESPONSE_MAPPING_TIME STRING,
    C_BANK_RESPONSE_UNMAPPING STRING,
    C_RESPONSE_UNMAPPING_TIME STRING,
    C_VSD_STATUS STRING,
    C_VSD_RESPONSE STRING,
    C_VSD_OPEN_FLAG DOUBLE,
    C_VSD_CLOSE_FLAG DOUBLE,
    C_COMM_START_DATE STRING,
    C_COMM_EXPIRE_DATE STRING,
    C_RECEIVE_FINAN_BILL DOUBLE,
    C_VSD_OPEN_STATUS STRING,
    C_VSD_OPEN_RESPONSE STRING,
    C_VSD_OPEN_LOCATION STRING,
    C_VSD_CLOSE_STATUS STRING,
    C_VSD_CLOSE_RESPONSE STRING,
    C_VSD_CLOSE_LOCATION STRING,
    C_VSD_OPEN_DATE STRING,
    C_VSD_CLOSE_DATE STRING,
    C_RECEIVED_FEE_CLOSE_ACC DOUBLE,
    C_CONFIRM_TYPE STRING,
    C_CONFIRM_USER STRING,
    FK_CONFIRM_CUSTOMER STRING,
    C_FILE_STATUS STRING,
    C_FILE_CONFIRM_DATE STRING,
    C_FILE_COMPLETING_LOCATION DOUBLE,
    C_IS_NEW_CUSTOMER DOUBLE,
    C_FILE_CONFIRM_USER STRING,
    C_FILE_CONFIRM_NOTE STRING,
    C_SOFT_FILE_STATUS STRING,
    C_SOFT_FILE_REJECT_REASON STRING,
    C_SOFT_FILE_REJECT_DATE STRING,
    C_FILE_STATUS_USER STRING,
    C_ADDRESS_SAVE_INFOR STRING,
    C_CUST_CARE_SERVICE_TYPE STRING,
    C_ATS_BANK_BRANCH_CD STRING,
    C_IS_ONBOARD DOUBLE,
    C_COPI24_TYPE STRING,
    C_VSD_OPEN_SEND_TIME STRING,
    C_FOR_TRADING_BOND DOUBLE,
    C_VSD_FIRST_OPEN_SEND_TIME STRING,
    C_CARE_PACKAGE STRING
) WITH (
    'connector' = 'kafka',
    'topic' = 'oracle-bo-poc.BACK.T_BACK_ACCOUNT',
    'properties.bootstrap.servers' = '192.168.73.190:9092,192.168.73.191:9092,192.168.73.192:9092',
    'properties.group.id' = 'flink-cdc-back-account',
    'scan.startup.mode' = 'latest-offset',
    'value.format' = 'json',
    'json.ignore-parse-errors' = 'true'
);

-- ============================================
-- CREATE TABLE: StarRocks Sink
-- ============================================
CREATE TABLE mbs_realtime_db.t_back_account (
    PK_ACCOUNT STRING,
    C_ACCOUNT_BRANCH_CODE STRING,
    C_ACCOUNT_SUB_BRANCH_CODE STRING,
    C_CREATOR_CODE STRING,
    C_CREATOR_BRANCH_CODE STRING,
    C_CREATOR_SUB_BRANCH_CODE STRING,
    C_CREATE_TIME DATETIME,
    C_APPROVER_CODE STRING,
    C_APPROVE_TIME DATETIME,
    C_CUSTOMER_CODE STRING,
    C_ACCOUNT_CODE STRING,
    C_ACCOUNT_TYPE STRING,
    C_ACCOUNT_FRONT_TYPE STRING,
    C_ACCOUNT_RELATION_TYPE STRING,
    C_STAFF_FLAG STRING,
    C_MARKETING_ID STRING,
    C_TAX_FLAG STRING,
    C_OPEN_DATE STRING,
    C_CLOSE_DATE STRING,
    C_BANK_CODE STRING,
    C_BANK_ACCOUNT STRING,
    C_COMM_PACKAGE STRING,
    C_ACCOUNT_STATUS STRING,
    C_CLOSER_CODE STRING,
    C_CLOSE_TIME DATETIME,
    C_NEW_CUST_EXPIRE_DATE STRING,
    C_COLLABORATOR STRING,
    C_MODIFY_USER_CODE STRING,
    C_RESTRICTION_ID STRING,
    C_CHANNEL STRING,
    C_GROUP_CODE STRING,
    C_ACCOUNT_CREDIT_TYPE DOUBLE,
    C_ORIGIN_ACCOUNT_CODE STRING,
    C_ACCOUNT_LEVEL STRING,
    C_CAN_SHORT_SELL STRING,
    C_CAN_OVER_CREDIT STRING,
    C_FORCE_SELL STRING,
    C_LENDING_SELL STRING,
    C_TRADING_STATUS DOUBLE,
    C_ONLINE_ACCOUNT_TYPE STRING,
    C_SUB_MARKETING_ID STRING,
    C_CHANGED_TAB STRING,
    C_TC_SIGNED_STATUS DOUBLE,
    C_ODD_LOT_CONTRACT_SIGNED DOUBLE,
    C_ODD_LOT_CONTRACT_NOTE STRING,
    C_DEPOSIT_APPROVER_CODE STRING,
    C_DEPOSIT_APPROVE_DATE STRING,
    C_COMM_BASE_RATE DOUBLE,
    C_ATS_FLAG DOUBLE,
    C_ATS_BANK_ACCOUNT STRING,
    C_ATS_BANK STRING,
    C_BANK_RESPONSE_MAPPING STRING,
    C_RESPONSE_MAPPING_TIME DATETIME,
    C_BANK_RESPONSE_UNMAPPING STRING,
    C_RESPONSE_UNMAPPING_TIME DATETIME,
    C_VSD_STATUS STRING,
    C_VSD_RESPONSE STRING,
    C_VSD_OPEN_FLAG DOUBLE,
    C_VSD_CLOSE_FLAG DOUBLE,
    C_COMM_START_DATE STRING,
    C_COMM_EXPIRE_DATE STRING,
    C_RECEIVE_FINAN_BILL DOUBLE,
    C_VSD_OPEN_STATUS STRING,
    C_VSD_OPEN_RESPONSE STRING,
    C_VSD_OPEN_LOCATION STRING,
    C_VSD_CLOSE_STATUS STRING,
    C_VSD_CLOSE_RESPONSE STRING,
    C_VSD_CLOSE_LOCATION STRING,
    C_VSD_OPEN_DATE STRING,
    C_VSD_CLOSE_DATE STRING,
    C_RECEIVED_FEE_CLOSE_ACC DOUBLE,
    C_CONFIRM_TYPE STRING,
    C_CONFIRM_USER STRING,
    FK_CONFIRM_CUSTOMER STRING,
    C_FILE_STATUS STRING,
    C_FILE_CONFIRM_DATE STRING,
    C_FILE_COMPLETING_LOCATION DOUBLE,
    C_IS_NEW_CUSTOMER DOUBLE,
    C_FILE_CONFIRM_USER STRING,
    C_FILE_CONFIRM_NOTE STRING,
    C_SOFT_FILE_STATUS STRING,
    C_SOFT_FILE_REJECT_REASON STRING,
    C_SOFT_FILE_REJECT_DATE STRING,
    C_FILE_STATUS_USER STRING,
    C_ADDRESS_SAVE_INFOR STRING,
    C_CUST_CARE_SERVICE_TYPE STRING,
    C_ATS_BANK_BRANCH_CD STRING,
    C_IS_ONBOARD DOUBLE,
    C_COPI24_TYPE STRING,
    C_VSD_OPEN_SEND_TIME DATETIME,
    C_FOR_TRADING_BOND DOUBLE,
    C_VSD_FIRST_OPEN_SEND_TIME DATETIME,
    C_CARE_PACKAGE STRING
) WITH (
    'connector' = 'starrocks',
    'jdbc-url' = 'jdbc:mysql://kube-starrocks-fe-service.warehouse.svc.cluster.local:9030',
    'load-url' = 'http://kube-starrocks-fe-service.warehouse.svc.cluster.local:8030',
    'database-name' = 'mbs_realtime_db',
    'table-name' = 't_back_account',
    'username' = 'mbs_demo',
    'password' = 'mbs_demo',
    'sink.properties.format' = 'json',
    'sink.buffer-flush.max-rows' = '5000',
    'sink.buffer-flush.interval-ms' = '15000',
    'sink.max-retries' = '3'
);

-- ============================================
-- Insert Data from Kafka to StarRocks
-- ============================================
INSERT INTO dwd_back_account
SELECT 
    PK_ACCOUNT,
    C_ACCOUNT_BRANCH_CODE,
    C_ACCOUNT_SUB_BRANCH_CODE,
    C_CREATOR_CODE,
    C_CREATOR_BRANCH_CODE,
    C_CREATOR_SUB_BRANCH_CODE,
    C_CREATE_TIME,
    C_APPROVER_CODE,
    C_APPROVE_TIME,
    C_CUSTOMER_CODE,
    C_ACCOUNT_CODE,
    C_ACCOUNT_TYPE,
    C_ACCOUNT_FRONT_TYPE,
    C_ACCOUNT_RELATION_TYPE,
    C_STAFF_FLAG,
    C_MARKETING_ID,
    C_TAX_FLAG,
    C_OPEN_DATE,
    C_CLOSE_DATE,
    C_BANK_CODE,
    C_BANK_ACCOUNT,
    C_COMM_PACKAGE,
    C_ACCOUNT_STATUS,
    C_CLOSER_CODE,
    C_CLOSE_TIME,
    C_NEW_CUST_EXPIRE_DATE,
    C_COLLABORATOR,
    C_MODIFY_USER_CODE,
    C_RESTRICTION_ID,
    C_CHANNEL,
    C_GROUP_CODE,
    C_ACCOUNT_CREDIT_TYPE,
    C_ORIGIN_ACCOUNT_CODE,
    C_ACCOUNT_LEVEL,
    C_CAN_SHORT_SELL,
    C_CAN_OVER_CREDIT,
    C_FORCE_SELL,
    C_LENDING_SELL,
    C_TRADING_STATUS,
    C_ONLINE_ACCOUNT_TYPE,
    C_SUB_MARKETING_ID,
    C_CHANGED_TAB,
    C_TC_SIGNED_STATUS,
    C_ODD_LOT_CONTRACT_SIGNED,
    C_ODD_LOT_CONTRACT_NOTE,
    C_DEPOSIT_APPROVER_CODE,
    C_DEPOSIT_APPROVE_DATE,
    C_COMM_BASE_RATE,
    C_ATS_FLAG,
    C_ATS_BANK_ACCOUNT,
    C_ATS_BANK,
    C_BANK_RESPONSE_MAPPING,
    C_RESPONSE_MAPPING_TIME,
    C_BANK_RESPONSE_UNMAPPING,
    C_RESPONSE_UNMAPPING_TIME,
    C_VSD_STATUS,
    C_VSD_RESPONSE,
    C_VSD_OPEN_FLAG,
    C_VSD_CLOSE_FLAG,
    C_COMM_START_DATE,
    C_COMM_EXPIRE_DATE,
    C_RECEIVE_FINAN_BILL,
    C_VSD_OPEN_STATUS,
    C_VSD_OPEN_RESPONSE,
    C_VSD_OPEN_LOCATION,
    C_VSD_CLOSE_STATUS,
    C_VSD_CLOSE_RESPONSE,
    C_VSD_CLOSE_LOCATION,
    C_VSD_OPEN_DATE,
    C_VSD_CLOSE_DATE,
    C_RECEIVED_FEE_CLOSE_ACC,
    C_CONFIRM_TYPE,
    C_CONFIRM_USER,
    FK_CONFIRM_CUSTOMER,
    C_FILE_STATUS,
    C_FILE_CONFIRM_DATE,
    C_FILE_COMPLETING_LOCATION,
    C_IS_NEW_CUSTOMER,
    C_FILE_CONFIRM_USER,
    C_FILE_CONFIRM_NOTE,
    C_SOFT_FILE_STATUS,
    C_SOFT_FILE_REJECT_REASON,
    C_SOFT_FILE_REJECT_DATE,
    C_FILE_STATUS_USER,
    C_ADDRESS_SAVE_INFOR,
    C_CUST_CARE_SERVICE_TYPE,
    C_ATS_BANK_BRANCH_CD,
    C_IS_ONBOARD,
    C_COPI24_TYPE,
    C_VSD_OPEN_SEND_TIME,
    C_FOR_TRADING_BOND,
    C_VSD_FIRST_OPEN_SEND_TIME,
    C_CARE_PACKAGE
FROM ods_back_account;
